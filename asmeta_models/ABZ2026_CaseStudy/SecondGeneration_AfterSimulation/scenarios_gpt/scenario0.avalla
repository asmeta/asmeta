scenario scenario0

load ./../RoverReducedMain.asm

// --- Initial state checks (from RoverReducedMain default init s0)
check currentPosition = (0,0);
check goal = (0,0);
check batteryLevel = 95;
check recharge = false;
check atGoal = false;
check isAtCharger = false;
check moving = false;
check panelState = CLOSED;
check chargingComplete = false;
check noplan = false;
check failure = false;
check awaitingInstructions = false;
check plan2C = [];
check activePlan = [];

// --- Environment + mission setup
set chargers := {(5,3)};                       // (5,3) is a charger
set goal := (5,3);                             // mission goal is the charger
set planSet := {[]};                           // keep CPC "happy" (non-empty planSet -> noplan=false)
set planningFailure := false;
set goalSet := false;                          // not used unless awaitingInstructions=true

// Provide a concrete movement plan to reach (5,3) in 8 moves
set activePlan := [(1,0),(2,0),(3,0),(4,0),(5,0),(5,1),(5,2),(5,3)];
set moving := true;

// =====================
// Step 1: move to (1,0)
// =====================
set measuredBatteryLevel := 20;
set chargingComplete := false;
step
check currentPosition = (1,0);
check moving = true;
check isAtCharger = false;
check panelState = CLOSED;
check atGoal = false;
check chargingComplete = false;
check failure = false;
check noplan = false;
check awaitingInstructions = false;
check batteryLevel = 19;

// =====================
// Step 2: move to (2,0)
// =====================
set measuredBatteryLevel := 18;
set chargingComplete := false;
step
check currentPosition = (2,0);
check moving = true;
check isAtCharger = false;
check panelState = CLOSED;
check atGoal = false;
check chargingComplete = false;
check batteryLevel = 17;

// =====================
// Step 3: move to (3,0)
// =====================
set measuredBatteryLevel := 16;
set chargingComplete := false;
step
check currentPosition = (3,0);
check moving = true;
check isAtCharger = false;
check panelState = CLOSED;
check atGoal = false;
check chargingComplete = false;
check batteryLevel = 15;

// =====================
// Step 4: move to (4,0)
// =====================
set measuredBatteryLevel := 14;
set chargingComplete := false;
step
check currentPosition = (4,0);
check moving = true;
check isAtCharger = false;
check panelState = CLOSED;
check atGoal = false;
check chargingComplete = false;
check batteryLevel = 13;

// =====================
// Step 5: move to (5,0)
// =====================
set measuredBatteryLevel := 12;
set chargingComplete := false;
step
check currentPosition = (5,0);
check moving = true;
check isAtCharger = false;
check panelState = CLOSED;
check atGoal = false;
check chargingComplete = false;
check batteryLevel = 11;

// =====================
// Step 6: move to (5,1)
// =====================
set measuredBatteryLevel := 10;
set chargingComplete := false;
step
check currentPosition = (5,1);
check moving = true;
check isAtCharger = false;
check panelState = CLOSED;
check atGoal = false;
check chargingComplete = false;
check batteryLevel = 9;

// =====================
// Step 7: move to (5,2)
// =====================
set measuredBatteryLevel := 8;
set chargingComplete := false;
step
check currentPosition = (5,2);
check moving = true;
check isAtCharger = false;
check panelState = CLOSED;
check atGoal = false;
check chargingComplete = false;
check batteryLevel = 7;

// =====================
// Step 8: arrive at charger goal (5,3)
// =====================
set measuredBatteryLevel := 6;
set chargingComplete := false;
step
check currentPosition = (5,3);
check atGoal = true;
check isAtCharger = true;

// Solar panel controller should open panels when at a charger
check panelState = OPEN;

check chargingComplete = false;
check batteryLevel = 5;

// ==================================================
// Step 9: battery now low -> rover must (re)charge
// (we drive battery low via measuredBatteryLevel)
// ==================================================
set measuredBatteryLevel := 2;
set chargingComplete := false;
step
check currentPosition = (5,3);
check atGoal = true;
check isAtCharger = true;
check panelState = OPEN;

// In this reduced model, "recharge" becomes true when battery is too low
check recharge = true;

check chargingComplete = false;
check batteryLevel = 1;

// ========================================
// Step 10: charging completes -> close panel
// ========================================
set measuredBatteryLevel := 100;   // battery back up while charging
set chargingComplete := true;
step
check currentPosition = (5,3);
check atGoal = true;
check isAtCharger = true;

check chargingComplete = true;
// Solar panel controller should close panels when charging is complete
check panelState = CLOSED;

check batteryLevel = 95;