[![Static Badge](https://img.shields.io/badge/asmeta-main_repository-black?style=social&logo=github&link=https%3A%2F%2Fgithub.com%2Fasmeta%2Fasmeta)](https://github.com/asmeta/asmeta)
# EvoAvalla

**EvoAvalla** is an automated tool that uses **Evo**Suite to generate test scenarios in **Avalla** language for an 
Abstract State Machine (ASM).

The approach adopted in EvoAvalla involves translating an ASMETA specification into Java language,
allowing the use of an automatic test generation tool such as EvoSuite to produce test scenarios in JUnit format. 
These scenarios are subsequently translated into Avalla language to test the original ASMETA specification.

To achieve this, EvoAvalla is divided into three microservices:

![image](https://github.com/user-attachments/assets/e7342fd0-2aff-4b74-bf08-18f59ef3c8ad)

1. [**Asmetal2Java**](https://github.com/asmeta/asmeta/tree/master/code/experimental/asmeta.asmetal2java/asmeta.asmetal2java.codegen):  
   This service takes an Asmeta specification as input and translates it into a Java class.

2. [**Evosuite**](https://github.com/EvoSuite/evosuite):  
   Evosuite is a test generation tool that automatically generates JUnit test suites for Java classes.

3. [**Junit2Avalla**](https://github.com/asmeta/asmeta/tree/master/code/experimental/asmeta.evotest/asmeta.evotest.junit2avalla):  
   The final service in the pipeline, Junit2Avalla, is responsible for translating JUnit test scenarios into Avalla test scenarios.

## Installation

To start using EvoAvalla, you need to have [Docker Desktop](https://www.docker.com/products/docker-desktop) installed on your machine.

Make sure you have it installed and then clone the repository:

```shell
git clone git@github.com:asmeta/asmeta.git
```

Then go to the root directory of this project:

```shell
cd .\asmeta\code\experimental\asmeta.evotest\asmeta.evotest.evoavalla\
```

(You only need this project to run the application).

> **Note:** Currently, this project only works on **Windows** machines because it uses a batch file (`exec.bat`).

## How to Start

Follow these steps to run the application:

1. **Open Docker Desktop:**

    Open and run Docker Desktop.

2. **Prepare Your Input File:**

    Copy the absolute path of the considered asmeta specification.

3. **Run the Project:**

    Run the following command to execute the project:
    
    ```cmd
    start .\start.bat
    ```
    
    When prompted by the cmd application, paste the absolute path copied in the previous step.
    
    Check and update the current configuration if necessary and follow the instructions provided by the cmd application.
    
    Finally, the application provides the output Avalla files in the `./output` folder.

## System Architecture

EvoAvalla is structured as a series of microservices built on Docker:

1. [**Asmetal2Java**](https://github.com/asmeta/asmeta/tree/master/code/experimental/asmeta.asmetal2java/asmeta.asmetal2java.codegen): Converts the .asm input file into a Java application.
2. [**Evosuite**](https://github.com/EvoSuite/evosuite): Generates a Junit test suite (scenarios) for the newly created Java application.
3. [**Junit2Avalla**](https://github.com/asmeta/asmeta/tree/master/code/experimental/asmeta.evotest/asmeta.evotest.junit2avalla): Converts the Junit test scenarios into Avalla language.

These projects are built and integrated into EvoAvalla using a GitHub Action CI pipeline.
This pipeline automates the building of Docker images for each project,
making them available for use in EvoAvalla via the `compose.yaml` file.

## Repository Structure

The project repository is organized into the following folders:

- **`output/`**:  The output `.avalla` files generated by the services will be located here.

- **`services/`**:  This folder contains subfolders for each microservice that the application uses. It stores Docker volumes,
  which are needed for the services to communicate with each other and persist data between containers.

- **`scripts/`**: This folder contains scripts needed to run the application.

The entry point file **`start.bat`** is located in the root directory and must be run from this context.

The **`.env`** file stores container environment variables and allows us to customize configurations, if this file is deleted the application creates a new one with default values.
